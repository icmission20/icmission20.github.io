<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
  <style>
    html, body {
      height: 100%;
      overflow: hidden;
    }
  </style>
  <script>
    function sendHit() {
      /* Set PostUrl to the "Web app url" of the Google Apps Script */
      const postUrl = "https://script.google.com/macros/s/AKfycbw_lzooqAJ9AOGOyehZfPV2bVUYnW3sJz1HKxOJEYcFwMkt6Z3RZlSAoW9ul-NzHbbn/exec";
      const base64regex = /^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/;
      const queryString = window.location.search;
      const urlParams = new URLSearchParams(queryString.slice(1));
      console.log(JSON.stringify(urlParams));
      
      /* Check if the redirect target exists, and is encoded in valid base64 */
      if (urlParams.target !== undefined && base64regex.test(urlParams.target)) {
        const target = window.atob(urlParams.target);
      } else {
        return;
      }

      /* Make a POST request with the URL parameters as the body */
      fetch(postUrl, {
        method: "POST", 
        body: JSON.stringify(urlParams)
      }).then(res => console.log("Request complete! response:", res));
      
      /* Redirect the user to target */
      console.log("Redirecting to: " + target + queryString);
      window.location.replace(target + queryString);
    }
  </script>
</head>
<body onload="sendHit()"></body>
</html>
